test_that("test Ward dispersal seeding algorithm", {
  # define the module and path
  module <- list("Biomass_core")
  path <- list(modulePath="~/GitHub/LandWeb/m/Biomass_core",
               outputPath="~/GitHub/LandWeb/output")
  parameters <- list(.progress = list(type = "graphical", interval = 1),
                     .globals = list(verbose = FALSE),
                     Biomass_core = list( .saveInitialTime = NA))

  reducedPixelGroupMap <- raster(xmn = 50, xmx = 50 + 99*100,
                                 ymn = 50, ymx = 50 + 99*100,
                                 res = c(100, 100), val = 2)
  c <- expand.grid(data.frame(a = seq(5, 99, by = 9), b = seq(5, 99, by = 9)))
  pixelindex <- (c$a-1)*99+c$b #121
  reducedPixelGroupMap[pixelindex] <- 1
  seedReceive <- data.table(pixelGroup = 2, speciesCode = 7, seeddistance_eff = 30,
                            seeddistance_max = 200, key = "speciesCode")
  seedSource <- data.table(speciesCode = 7, seeddistance_eff = 30,
                           seeddistance_max = 200, pixelGroup = 1, key = "speciesCode")
  species <- read.csv("~/GitHub/LandWeb/inputs/species.csv",
                      header = TRUE, stringsAsFactor = FALSE)
  species <- data.table(species)[, speciesCode := 1:16]
  objects <- list("species" = species)
  mySim <- simInit(times = list(start = 0, end = 2),
                   params = parameters,
                   modules = module,
                   objects = objects,
                   paths = path)
  inSituReceived <- data.table(fromInit = numeric(), species = character())
  set.seed(1)
  source(file.path(modulePath(mySim), "Biomass_core", "R", "seedDispersalLANDIS.R"))
  output <- LANDISDisp(mySim, dtRcv = seedReceive, plot.it = FALSE,
                       dtSrc = seedSource,
                       inSituReceived = inSituReceived,
                       species = species,
                       reducedPixelGroupMap,
                       maxPotentialsLength = 3e5,
                       verbose = globals(mySim)$verbose)
  output_compared <- data.table(
    pixelIndex = c(230, 302, 311, 320, 329, 338, 347, 356, 365, 374, 375, 383,
                   392, 400, 402, 409, 411, 418, 420, 429, 436, 438, 445, 447, 454,
                   456, 463, 465, 472, 474, 481, 483, 490, 492, 500, 509, 518, 527,
                   536, 545, 554, 555, 563, 572, 581, 590, 1193, 1202, 1211, 1220,
                   1229, 1238, 1247, 1256, 1265, 1274, 1283, 1291, 1293, 1300, 1302,
                   1309, 1311, 1318, 1320, 1327, 1329, 1336, 1338, 1345, 1347, 1354,
                   1356, 1363, 1365, 1372, 1374, 1381, 1383, 1391, 1400, 1409, 1418,
                   1427, 1436, 1445, 1454, 1463, 1472, 1473, 1481, 2084, 2093, 2102,
                   2111, 2120, 2129, 2138, 2147, 2156, 2157, 2165, 2174, 2182, 2184,
                   2191, 2193, 2202, 2209, 2211, 2218, 2220, 2227, 2229, 2236, 2238,
                   2245, 2247, 2254, 2256, 2263, 2265, 2272, 2282, 2283, 2291, 2300,
                   2301, 2309, 2318, 2327, 2336, 2345, 2354, 2363, 2372, 2975, 2984,
                   2993, 3002, 3011, 3020, 3029, 3030, 3038, 3047, 3048, 3056, 3065,
                   3073, 3075, 3082, 3084, 3091, 3093, 3100, 3102, 3109, 3111, 3118,
                   3120, 3127, 3129, 3136, 3138, 3145, 3147, 3154, 3156, 3163, 3165,
                   3173, 3182, 3191, 3199, 3200, 3209, 3218, 3227, 3236, 3245, 3254,
                   3263, 3866, 3875, 3884, 3893, 3902, 3911, 3920, 3921, 3929, 3938,
                   3947, 3956, 3964, 3966, 3973, 3975, 3982, 3984, 3991, 3993, 4000,
                   4002, 4009, 4011, 4018, 4020, 4027, 4029, 4036, 4038, 4045, 4047,
                   4054, 4056, 4057, 4064, 4072, 4073, 4082, 4091, 4092, 4100, 4109,
                   4118, 4127, 4136, 4145, 4154, 4757, 4766, 4775, 4784, 4793, 4802,
                   4811, 4820, 4829, 4838, 4847, 4855, 4857, 4864, 4866, 4873, 4875,
                   4882, 4884, 4891, 4893, 4900, 4902, 4909, 4911, 4918, 4920, 4927,
                   4929, 4936, 4938, 4945, 4947, 4955, 4964, 4973, 4982, 4991, 5000,
                   5009, 5018, 5027, 5036, 5045, 5621, 5648, 5657, 5666, 5675, 5684,
                   5693, 5702, 5711, 5720, 5729, 5738, 5746, 5748, 5755, 5757, 5764,
                   5766, 5773, 5775, 5782, 5784, 5791, 5793, 5800, 5802, 5809, 5811,
                   5818, 5820, 5827, 5829, 5836, 5838, 5846, 5855, 5863, 5864, 5873,
                   5882, 5890, 5891, 5900, 5909, 5917, 5927, 5936, 6539, 6540, 6548,
                   6557, 6566, 6575, 6584, 6593, 6602, 6611, 6620, 6629, 6637, 6639,
                   6646, 6648, 6657, 6664, 6666, 6673, 6675, 6682, 6684, 6691, 6693,
                   6700, 6702, 6709, 6711, 6718, 6720, 6727, 6729, 6737, 6738, 6746,
                   6755, 6764, 6773, 6782, 6791, 6800, 6809, 6818, 6827, 7430, 7439,
                   7448, 7457, 7466, 7475, 7484, 7493, 7502, 7511, 7519, 7520, 7528,
                   7530, 7537, 7539, 7546, 7548, 7555, 7557, 7564, 7566, 7573, 7575,
                   7582, 7584, 7591, 7593, 7600, 7602, 7609, 7611, 7618, 7620, 7628,
                   7637, 7646, 7655, 7664, 7673, 7682, 7691, 7700, 7709, 7718, 8258,
                   8321, 8330, 8339, 8348, 8349, 8357, 8366, 8374, 8375, 8384, 8393,
                   8402, 8411, 8419, 8421, 8422, 8428, 8437, 8439, 8446, 8448, 8455,
                   8457, 8464, 8466, 8473, 8475, 8482, 8484, 8491, 8493, 8500, 8502,
                   8509, 8511, 8519, 8528, 8537, 8546, 8555, 8564, 8573, 8582, 8591,
                   8600, 8609, 9212, 9221, 9230, 9239, 9248, 9249, 9257, 9266, 9275,
                   9284, 9285, 9293, 9302, 9310, 9312, 9319, 9321, 9328, 9330, 9337,
                   9339, 9346, 9348, 9355, 9357, 9364, 9366, 9373, 9375, 9382, 9384,
                   9391, 9393, 9400, 9402, 9410, 9419, 9428, 9436, 9437, 9446, 9455,
                   9456, 9464, 9473, 9482, 9491, 9500),
    speciesCode = 7,
    key = c("pixelIndex", "speciesCode")
  )
  expect_equal(output,output_compared)
})
